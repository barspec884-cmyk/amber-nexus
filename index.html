<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Amber Nexus - Interactive Controller</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <style>
    :root { --bg: #0b0c10; --accent: #c5a880; --panel: rgba(20, 25, 30, 0.9); }
    body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; display: flex; height: 100vh; width: 100vw; overflow: hidden; }
    
    #sidebar { width: 320px; background: var(--panel); border-right: 1px solid rgba(197, 168, 128, 0.3); padding: 20px; box-sizing: border-box; overflow-y: auto; backdrop-filter: blur(10px); z-index: 10; }
    #sidebar::-webkit-scrollbar { width: 6px; }
    #sidebar::-webkit-scrollbar-thumb { background: rgba(197, 168, 128, 0.5); border-radius: 3px; }
    
    #main-container { flex: 1; height: 100%; position: relative; background: #000; }
    #main { width: 100%; height: 100%; }
    
    h3 { color: var(--accent); font-size: 13px; border-left: 3px solid var(--accent); padding-left: 8px; margin: 20px 0 12px; }
    .control-group { margin-bottom: 16px; }
    label { display: flex; justify-content: space-between; font-size: 11px; color: #aaa; margin-bottom: 6px; }
    .slider-hint { font-size: 9px; color: #666; margin-top: -4px; margin-bottom: 4px; display: flex; justify-content: space-between; }
    input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; height: 4px; }
    .val-disp { color: var(--accent); font-weight: bold; }
    input[type=number]{
  width: 100%;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(197, 168, 128, 0.5);
  color: #fff;
  border-radius: 6px;
  padding: 8px 10px;
  font-size: 12px;
  outline: none;
  box-sizing: border-box;
}
input[type=number]:focus{
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(197,168,128,0.15);
}
    select.barrel-select { width: 100%; padding: 8px; background: rgba(255,255,255,0.05); border: 1px solid rgba(197, 168, 128, 0.5); color: var(--accent); border-radius: 4px; font-size: 12px; outline: none; cursor: pointer; margin-bottom: 5px; }
    select.barrel-select option { background: #1a1a1a; color: #fff; }
    .cask-label { font-size: 10px; color: #888; margin-bottom: 2px; }
	  @media (max-width: 768px) {
      body { 
        flex-direction: column-reverse; 
      }
      #sidebar { 
        width: 100%; 
        height: 50vh; 
        border-right: none; 
        border-top: 1px solid rgba(197, 168, 128, 0.3); 
      }
      #main-container { 
        width: 100%; 
        height: 50vh; 
      }
    }
	  
	  
  </style>
</head>
<body>

<div id="sidebar">
  <div style="font-size: 22px; font-weight: bold; color: var(--accent); margin-bottom: 5px;">Amber Nexus</div>
  <div style="font-size: 10px; color: #888; margin-bottom: 15px;">Tasting Topology System</div>

<h3>ğŸ“‹ åŸºæœ¬æƒ…å ± (Identity)</h3>
<div class="control-group">
  <label style="display:block; margin-bottom:4px;">ã‚³ã‚¢å (Core Label)</label>
  <input type="text" id="i-corename" maxlength="24" value="Amber Palette"
    placeholder="ä¾‹: Yamazaki 12"
    style="width:100%; background:rgba(255,255,255,0.05); border:1px solid rgba(197,168,128,0.5);
           color:#fff; border-radius:6px; padding:8px 10px; font-size:12px; outline:none;
           box-sizing:border-box; font-family:sans-serif;"
    oninput="syncParam()">
  <div class="slider-hint"><span>ã‚°ãƒ©ãƒ•ä¸­å¿ƒã«è¡¨ç¤ºã•ã‚Œã¾ã™</span></div>
</div>

<div class="control-group">
  <label>
    Age (ç†Ÿæˆå¹´æ•°)
    <span class="val-disp"><span id="v-age">12</span> Years</span>
  </label>
  <div class="slider-hint"><span>Young (æš´ã‚Œã‚‹)</span><span>Aged (çµ±åˆ)</span></div>
  <input type="number" id="i-age" min="0" max="100" step="1" value="12" oninput="syncParam()">
</div>

<div class="control-group">
  <label>
    ABV (ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«åº¦æ•°)
    <span class="val-disp"><span id="v-abv">43.0</span> %</span>
  </label>
  <div class="slider-hint"><span>40.0% (ç©ã‚„ã‹)</span><span>98.0% (çˆ†ç™ºçš„)</span></div>
  <input type="number" id="i-abv" min="40" max="98" step="0.1" value="43.0" oninput="syncParam()">
</div>

<div class="control-group">
  <div class="cask-label">ã‚¦ã‚£ã‚¹ã‚­ãƒ¼åˆ†é¡ (Type)</div>
  <select id="s-whisky-type" class="barrel-select" onchange="syncParam()">
    <option value="scotch">Scotchï¼ˆã‚¹ã‚³ãƒƒãƒï¼‰</option>
    <option value="irish">Irishï¼ˆã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ï¼‰</option>
    <option value="american">Americanï¼ˆã‚¢ãƒ¡ãƒªã‚«ãƒ³ï¼‰</option>
    <option value="canadian">Canadianï¼ˆã‚«ãƒŠãƒ‡ã‚£ã‚¢ãƒ³ï¼‰</option>
    <option value="japanese" selected>Japaneseï¼ˆã‚¸ãƒ£ãƒ‘ãƒ‹ãƒ¼ã‚ºï¼‰</option>
    <option value="other">Otherï¼ˆãã®ä»–ï¼‰</option>
  </select>
</div>

  <h3>æ¨½ã®ç’°å¢ƒ (Cask Atlas)</h3>
  <div class="control-group">
    <div class="cask-label">Base Cask (åŸºæœ¬æ¨½)</div>
    <select id="s-barrel" class="barrel-select" onchange="syncParam()">
      <option value="reset">â— Standard (åŸºæœ¬)</option>
      <option value="bourbon" selected>â— Bourbon (ãƒãƒ‹ãƒ©ãƒ»èœ‚èœœ)</option>
      <option value="american_oak">â— American Oak (ãƒãƒ‹ãƒ©ãƒ»ãƒ¬ãƒ¢ãƒ³)</option>
      <option value="european_oak">â–  European Oak (é‡åšãƒ»ã‚¿ãƒ³ãƒ‹ãƒ³)</option>
      <option value="mizunara">â–² Mizunara (é¦™æœ¨ãƒ»ã‚¹ãƒ‘ã‚¤ã‚¹)</option>
      <option value="px_sherry">â—† PX Sherry (æ¥µç”˜å£ãƒ»ãƒ¬ãƒ¼ã‚ºãƒ³)</option>
    </select>

    <div class="cask-label" style="margin-top: 10px;">Finish Cask (å¾Œç†Ÿ)</div>
    <select id="s-finish" class="barrel-select" onchange="syncParam()">
      <option value="none">ãªã— (None)</option>
      <option value="sauternes">â—† Sauternes (è²´è…ãƒ¯ã‚¤ãƒ³ãƒ»è¯ã‚„ã‹)</option>
      <option value="px_sherry">â—† PX Sherry (æ¥µç”˜å£ãƒ»ãƒ¬ãƒ¼ã‚ºãƒ³)</option>
      <option value="port">â—† Port Wine (èµ¤ãƒ™ãƒªãƒ¼ãƒ»ãƒ—ãƒ©ãƒ )</option>
      <option value="mizunara">â–² Mizunara (é¦™æœ¨ãƒ»ã‚¹ãƒ‘ã‚¤ã‚¹)</option>
      <option value="beer">â–  Beer/IPA/Stout (ãƒ›ãƒƒãƒ—ãƒ»çˆç²)</option>
      <option value="rum">â— Rum (é»’ç³–ãƒ»ãƒˆãƒ­ãƒ”ã‚«ãƒ«)</option>
    </select>
  </div>

  <div class="control-group">
    <label>Cask Size (æ¨½ã®å¤§ãã•) <span class="val-disp" id="v-size">3</span></label>
    <div class="slider-hint"><span>Octave (å¯†é›†)</span><span>Butt (æ‹¡æ•£)</span></div>
    <input type="range" id="i-size" min="1" max="5" value="3" oninput="syncParam()">
  </div>

  <h3>ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ¼ (Mouthfeel)</h3>
  <div class="control-group">
    <label>Body (ç²˜åº¦ãƒ»é‡ã•) <span class="val-disp" id="v-body">5</span></label>
    <input type="range" id="i-body" min="1" max="10" value="5" oninput="syncParam()">
  </div>
  <div class="control-group">
    <label>Crisp (ã‚­ãƒ¬ãƒ»é®®åº¦) <span class="val-disp" id="v-crisp">5</span></label>
    <input type="range" id="i-crisp" min="1" max="10" value="5" oninput="syncParam()">
  </div>
  <div class="control-group">
    <label>Heat (ç†±é‡ãƒ»ã‚¢ã‚¿ãƒƒã‚¯) <span class="val-disp" id="v-heat">5</span></label>
    <input type="range" id="i-heat" min="1" max="10" value="5" oninput="syncParam()">
  </div>
  <div class="control-group">
    <label>Grip (åæ–‚å‘³ãƒ»æ¨½æ¸‹) <span class="val-disp" id="v-grip">5</span></label>
    <input type="range" id="i-grip" min="1" max="10" value="5" oninput="syncParam()">
  </div>

  <h3>å‘³ã‚ã„ã®åº§æ¨™ (Flavor Matrix)</h3>
  <div class="control-group">
    <label>Sweet (ç”˜å£åº¦) <span class="val-disp" id="v-sweet">5</span></label>
    <input type="range" id="i-sweet" min="0" max="10" value="5" oninput="syncParam()">
  </div>
  <div class="control-group">
    <label>Woody (æ¨½é¦™åº¦) <span class="val-disp" id="v-woody">5</span></label>
    <input type="range" id="i-woody" min="0" max="10" value="5" oninput="syncParam()">
  </div>

  <h3>å¼·åº¦ (Intensity)</h3>
  <div class="control-group">
    <label>Aroma (é¦™ã‚Šã®åºƒãŒã‚Š) <span class="val-disp" id="v-aroma">3</span></label>
    <input type="range" id="i-aroma" min="1" max="5" value="3" oninput="syncParam()">
  </div>
  <div class="control-group">
    <label>Finish (ä½™éŸ»ã®æºã‚Œ) <span class="val-disp" id="v-finish">2</span></label>
    <input type="range" id="i-finish" min="1" max="5" value="2" oninput="syncParam()">
  </div>
</div>

<div id="main-container">
  <div id="main"></div>
</div>

<script>
  let myChart;
let params = {
  coreName: 'Amber Palette',
  whiskyType: 'japanese', // â†è¿½åŠ 
  barrel: 'bourbon', finish: 'none', caskSize: 3,
  spec: { age: 12, abv: 43 },
  texture: { body: 5, crisp: 5, heat: 5, grip: 5 },
  matrix: { sweet: 5, woody: 5 },
  intensity: { aroma: 3, finish: 2 }
};

  const atlasData = {
    bourbon:      { notes: ["Vanilla", "Coconut", "Toffee", "Honey", "Oak"], color: "#f4d03f" },
    american_oak: { notes: ["Vanilla", "Coconut", "Toffee", "Honey", "Oak", "Lemon"], color: "#f4d03f" },
    european_oak: { notes: ["Raisin", "Chocolate", "Nutmeg", "Tannin", "Oak", "Spice"], color: "#5c3a21" },
    mizunara:     { notes: ["Sandalwood", "Incense", "Spice", "Vanilla", "Coconut"], color: "#c5a880" },
    px_sherry:    { notes: ["Raisin", "Chocolate", "Fig", "Syrup", "Plum"], color: "#8c3b3b" },
    sauternes:    { notes: ["Apricot", "Honey", "Floral", "Lemon", "Syrup"], color: "#f1c40f" },
    port:         { notes: ["Plum", "Red Berry", "Chocolate", "Spice", "Tannin"], color: "#782844" },
    beer:         { notes: ["Hops", "Malt", "Coffee", "Chocolate", "Lemon"], color: "#d35400" },
    rum:          { notes: ["Brown Sugar", "Banana", "Pineapple", "Molasses", "Vanilla"], color: "#d68910" },
    none:         { notes: [], color: "#555" },
    reset:        { notes: [], color: "#555" }
  };
  const whiskyTypeBg = {
  scotch:   '#0f172a', // deep navy
  irish:    '#0b2e1a', // deep green
  american: '#2b1a0f', // dark amber brown
  canadian: '#2a1020', // wine/bordeaux
  japanese: '#111111', // sumi black
  other:    '#1f2937'  // dark gray-blue
};
  const flavors = [
    { n: "Vanilla", c: "sweet", score: 10, symbol: "circle" }, 
    { n: "Coconut", c: "sweet", score: 7, symbol: "circle" }, 
    { n: "Toffee", c: "sweet", score: 8, symbol: "circle" }, 
    { n: "Honey", c: "sweet", score: 8, symbol: "circle" },
    { n: "Brown Sugar", c: "sweet", score: 9, symbol: "circle" },
    { n: "Banana", c: "sweet", score: 8, symbol: "circle" },
    { n: "Pineapple", c: "sweet", score: 8, symbol: "circle" },
    { n: "Molasses", c: "sweet", score: 9, symbol: "circle" },
    { n: "Malt", c: "sweet", score: 6, symbol: "circle" },
    { n: "Raisin", c: "sweet", score: 8, symbol: "diamond" }, 
    { n: "Fig", c: "sweet", score: 6, symbol: "diamond" }, 
    { n: "Syrup", c: "sweet", score: 5, symbol: "diamond" },
    { n: "Apricot", c: "sweet", score: 8, symbol: "diamond" },
    { n: "Lemon", c: "sweet", score: 7, symbol: "diamond" },
    { n: "Floral", c: "sweet", score: 8, symbol: "diamond" },
    { n: "Plum", c: "sweet", score: 8, symbol: "diamond" },
    { n: "Red Berry", c: "sweet", score: 7, symbol: "diamond" },
    { n: "Oak", c: "woody", score: 8, symbol: "rect" }, 
    { n: "Chocolate", c: "sweet", score: 9, symbol: "rect" }, 
    { n: "Tannin", c: "woody", score: 6, symbol: "rect" },
    { n: "Coffee", c: "woody", score: 8, symbol: "rect" },
    { n: "Spice", c: "woody", score: 8, symbol: "triangle" }, 
    { n: "Sandalwood", c: "woody", score: 9, symbol: "triangle" }, 
    { n: "Incense", c: "woody", score: 6, symbol: "triangle" },
    { n: "Nutmeg", c: "woody", score: 7, symbol: "triangle" },
    { n: "Hops", c: "woody", score: 8, symbol: "triangle" }
  ];

  window.onload = function() {
    myChart = echarts.init(document.getElementById('main'));
    syncParam();
    window.addEventListener('resize', () => { myChart.resize(); update(); });
  };

  function syncParam() {
    params.coreName = document.getElementById('i-corename').value.trim() || 'Amber Palette';
    params.whiskyType = document.getElementById('s-whisky-type').value;
    params.barrel = document.getElementById('s-barrel').value;
    params.finish = document.getElementById('s-finish').value; // å¾Œç†Ÿã®å€¤å–å¾—
    
    params.spec.age = parseInt(document.getElementById('i-age').value);
    params.spec.abv = parseInt(document.getElementById('i-abv').value);
    params.caskSize = parseInt(document.getElementById('i-size').value);
    params.texture.body = parseInt(document.getElementById('i-body').value);
    params.texture.crisp = parseInt(document.getElementById('i-crisp').value);
    params.texture.heat = parseInt(document.getElementById('i-heat').value);
    params.texture.grip = parseInt(document.getElementById('i-grip').value);
    params.matrix.sweet = parseInt(document.getElementById('i-sweet').value);
    params.matrix.woody = parseInt(document.getElementById('i-woody').value);
    params.intensity.aroma = parseInt(document.getElementById('i-aroma').value);
    params.intensity.finish = parseInt(document.getElementById('i-finish').value);
    
    document.getElementById('v-age').innerText = params.spec.age;
    document.getElementById('v-abv').innerText = params.spec.abv.toFixed(1);
    document.getElementById('v-size').innerText = params.caskSize;
    document.getElementById('v-body').innerText = params.texture.body;
    document.getElementById('v-crisp').innerText = params.texture.crisp;
    document.getElementById('v-heat').innerText = params.texture.heat;
    document.getElementById('v-grip').innerText = params.texture.grip;
    document.getElementById('v-sweet').innerText = params.matrix.sweet;
    document.getElementById('v-woody').innerText = params.matrix.woody;
    document.getElementById('v-aroma').innerText = params.intensity.aroma;
    document.getElementById('v-finish').innerText = params.intensity.finish;
    
    update();
  }

  function update() {
    if(!myChart) return;
    const width = myChart.getWidth();
    const height = myChart.getHeight();

    const chartBg = whiskyTypeBg[params.whiskyType] || '#000';
    document.getElementById('main-container').style.background = chartBg;

    let coreColor = '#c5a880';
    if(params.texture.heat > 5) {
        const heatRatio = (params.texture.heat - 5) / 5;
        coreColor = heatRatio > 0.5 ? '#d97a33' : '#ce9159'; 
    }
    const coreGlow = 10 + (params.spec.age * 1.5) + (params.texture.heat * 2);

    const shiftX = (params.matrix.sweet - 5) * 30;
    const shiftY = (params.matrix.woody - 5) * 30;

    const nodes = [{
      name: params.coreName, 
      symbolSize: 60, 
      itemStyle: { color: coreColor, shadowBlur: coreGlow, shadowColor: coreColor },
      label: { show: true, position: 'inside', fontSize: 10, fontWeight: 'bold' },
      x: (width / 2) + shiftX,
      y: (height / 2) + shiftY,
      fixed: true 
    }];
    
    const links = [];
    const baseAtlas = atlasData[params.barrel];
    const finishAtlas = atlasData[params.finish];
    
    const calculatedEdgeLength = 40 + (params.caskSize - 1) * 20;
    const baseLineWidth = 0.5 + (params.texture.body * 0.3);

    flavors.forEach(f => {
      const isBaseNote = baseAtlas.notes.includes(f.n);
      const isFinishNote = finishAtlas.notes.includes(f.n);
      const isActive = isBaseNote || isFinishNote;

      if (!isActive) {
        nodes.push({
          name: f.n, symbol: f.symbol || 'circle', symbolSize: f.score * 2,
          itemStyle: { color: '#444', opacity: 0.4 }
        });
        links.push({
          source: params.coreName, target: f.n, edgeLength: calculatedEdgeLength,
          lineStyle: { width: baseLineWidth, color: 'rgba(255,255,255,0.1)' }
        });
        return;
      }

      // ãƒ™ãƒ¼ã‚¹ã¨ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã®æ›ã‘åˆã‚ã›ãƒ­ã‚¸ãƒƒã‚¯
      let nodeColor, lineColor, lineType, lineWidth, edgeLen;
      
      if (isBaseNote && isFinishNote) {
          // ä¸¡æ–¹ã«å…±é€šã™ã‚‹é¦™ã‚Šï¼ˆé‡ãªã£ã¦å¼·èª¿ã•ã‚Œã‚‹ï¼‰
          nodeColor = baseAtlas.color;
          lineColor = baseAtlas.color;
          lineType = 'solid';
          lineWidth = baseLineWidth * 3; // ã²ã¨ãã‚å¤ªã
          edgeLen = calculatedEdgeLength * 0.8; // ã‚³ã‚¢ã«å¼·ãçµã³ã¤ã
      } else if (isBaseNote) {
          // ãƒ™ãƒ¼ã‚¹ç”±æ¥ã®é¦™ã‚Š
          nodeColor = baseAtlas.color;
          lineColor = baseAtlas.color;
          lineType = 'solid';
          lineWidth = baseLineWidth * 2;
          edgeLen = calculatedEdgeLength;
      } else {
          // ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã®ã¿ç”±æ¥ã®é¦™ã‚Šï¼ˆå¾Œä»˜ã‘ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ï¼‰
          nodeColor = finishAtlas.color;
          lineColor = finishAtlas.color;
          lineType = 'dashed'; // ç ´ç·šã§ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚’è¡¨ç¾
          lineWidth = baseLineWidth * 1.5;
          edgeLen = calculatedEdgeLength * 1.3; // å°‘ã—å¤–å´ã‚’æ¼‚ã‚ã›ã‚‹
      }

      nodes.push({
        name: f.n,
        symbol: f.symbol || 'circle',
        symbolSize: f.score * 3.5,
        itemStyle: { color: nodeColor, opacity: 1 }
      });

      links.push({
        source: params.coreName, target: f.n,
        edgeLength: edgeLen,
        lineStyle: { width: lineWidth, color: lineColor, type: lineType }
      });
    });

    const explosionForce = (params.intensity.aroma * 50) + (params.spec.abv * 4);
    
    let integrationFriction = 0.05 + (params.spec.age * 0.015);
    integrationFriction -= (params.texture.crisp * 0.005); 
    if(integrationFriction < 0.01) integrationFriction = 0.01;

    const gripGravity = 0.1 + (params.texture.grip * 0.04) - (params.intensity.finish * 0.02);

    myChart.setOption({
      backgroundColor: chartBg,
      series: [{
        type: 'graph', layout: 'force', data: nodes, links: links,
        left: 'center', top: 'middle',
        label: { show: true, position: 'top', color: '#fff', fontSize: 11 },
        force: { repulsion: explosionForce, gravity: gripGravity, friction: integrationFriction },
        roam: true, draggable: true
      }]
    });
  }

</script>
</body>
</html>